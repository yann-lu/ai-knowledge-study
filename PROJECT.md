# 艾宾浩斯记忆助手项目文档

## 项目概述

艾宾浩斯记忆助手是一个基于艾宾浩斯遗忘曲线理论的智能学习复习系统，帮助用户科学地管理和复习知识点。

## 核心功能

### 1. 知识库管理
- 知识点的创建、编辑、删除
- 支持Markdown格式内容
- 自动生成知识点大纲
- 分类管理和标签系统
- 文件上传和解析（支持多种格式）

### 2. 复习计划
- 基于艾宾浩斯遗忘曲线的智能复习提醒
- 复习进度跟踪
- 复习日历视图
- 复习统计分析
- **可配置的复习策略** 🆕：支持两种"未掌握"处理策略，可动态切换

### 3. AI智能助手 🆕
- **知识点AI对话功能**：在每个知识点详情页面提供AI对话按钮
- **智能问答**：基于知识点内容进行上下文相关的问答
- **学习辅助**：
  - 总结核心内容
  - 生成面试题和练习题
  - 制定个性化学习计划
  - 解释难点和重点
  - 提供实践练习建议
- **快捷操作**：预设常用问题的快捷按钮

## 技术架构

### 后端技术栈
- **框架**：Spring Boot 3.x
- **数据库**：PostgreSQL
- **ORM**：Spring Data JPA
- **AI集成**：LangChain4j + 通义千问(Qwen)
- **文件解析**：Apache Tika

### 前端技术栈
- **框架**：Vue.js 3
- **样式**：Tailwind CSS
- **Markdown渲染**：Marked.js
- **代码高亮**：Highlight.js

## 最新更新 (2025-01-14)

### 复习策略配置功能 🆕

#### 功能概述
项目现在支持两种"未掌握"处理策略，可以通过配置文件动态切换，满足不同的学习需求。

#### 策略类型
1. **RESTART_FROM_TOMORROW（默认策略）**：
   - 当复习标记为"未掌握"时，删除所有现有复习计划
   - 从明天开始重新生成完整的10次复习计划
   - 适合希望严格按照艾宾浩斯曲线重新学习的场景

2. **ADD_EXTRA_REVIEWS（新策略）**：
   - 当复习标记为"未掌握"时，增加额外复习次数（默认2次）
   - 所有未完成的复习计划顺延相应天数
   - 保留原有复习计划结构，适合希望保持学习进度的场景

#### 配置方式
在`application.properties`中配置：
```properties
# 策略类型选择
review.strategy.not-mastered=RESTART_FROM_TOMORROW
# 额外复习次数（仅ADD_EXTRA_REVIEWS策略使用）
review.strategy.extra-review-count=2
```

#### 技术实现
- `ReviewStrategyConfig`：策略配置类，使用`@ConfigurationProperties`读取配置
- `ReviewPlanServiceImpl`：根据配置动态选择处理策略
- 支持热配置切换（重启应用后生效）

### AI对话功能

#### 前端实现
1. **UI组件**：
   - 在知识点详情页面添加"🤖 AI对话"按钮
   - 实现模态对话框，包含消息列表、输入框和快捷操作按钮
   - 支持实时消息显示和滚动

2. **交互功能**：
   - 用户可以与AI进行自然语言对话
   - 提供5个快捷操作按钮：总结内容、生成面试题、制定学习计划、解释难点、实践练习
   - 支持Markdown格式的消息渲染

#### 后端实现
1. **API接口**：
   - `POST /api/ai/chat`：处理AI对话请求
   - 接收用户消息、知识点上下文和知识点ID

2. **服务层**：
   - `AiChatService`：AI对话服务接口
   - `AiChatServiceImpl`：使用LangChain4j实现AI对话逻辑
   - 智能上下文构建，包含知识点标题、大纲和内容

3. **数据传输**：
   - `AiChatRequest`：对话请求DTO
   - `AiChatResponse`：对话响应DTO

#### 技术特点
- **上下文感知**：AI助手能够理解当前知识点的完整内容
- **专业化提示词**：针对学习场景优化的系统提示词
- **错误处理**：完善的异常处理和用户友好的错误提示
- **响应式设计**：适配不同屏幕尺寸的对话界面

## 使用方式

### 启动项目
1. 确保PostgreSQL数据库运行在端口15432
2. 配置`application.properties`中的数据库连接和AI API密钥
3. 运行`mvn spring-boot:run`
4. 访问`http://localhost:8089/knowledge.html`

### 使用AI对话功能
1. 进入任意知识点详情页面
2. 点击"🤖 AI对话"按钮打开对话框
3. 可以直接输入问题，或点击快捷操作按钮
4. AI会基于当前知识点内容提供相关回答和建议

## 核心参数

### 数据库配置
- 端口：15432
- 数据库名：ebbinghaus
- 用户名：postgres

### AI配置
- 模型：qwen-turbo (通义千问)
- API基础URL：https://dashscope.aliyuncs.com/compatible-mode/v1
- 温度参数：默认（适合学习场景）

### 服务器配置
- 端口：8089
- 文件上传限制：10MB

## 开发说明

### 添加新的AI功能
1. 在`AiChatServiceImpl`中扩展`buildSystemPrompt()`方法
2. 在前端添加新的快捷操作按钮
3. 根据需要调整提示词和响应格式

### 数据库扩展
- 所有实体类位于`com.memory.app.model`包
- Repository接口位于`com.memory.app.repository`包
- 使用JPA注解进行ORM映射

### API扩展
- 控制器位于`com.memory.app.controller`包
- 统一使用`/api`前缀
- 支持跨域请求（CORS）

## 未来规划

1. **AI功能增强**：
   - 支持多轮对话历史记录
   - 个性化学习建议
   - 智能复习提醒

2. **用户体验优化**：
   - 移动端适配
   - 离线模式支持
   - 主题切换

3. **数据分析**：
   - 学习进度可视化
   - 复习效果分析
   - 知识点掌握度评估